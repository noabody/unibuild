diff a/picodrive/PKGBUILD b/picodrive/PKGBUILD
--- a/picodrive/PKGBUILD	1969-12-31 17:00:00.000000000 -0700
+++ b/picodrive/PKGBUILD	1969-12-31 17:00:00.000000000 -0700
@@ -0,0 +1,51 @@
+# Maintainer: Noa Body <noabody@archlinux.org>
+
+pkgname=picodrive
+pkgver=1.99.r109.g5711398c
+pkgrel=1
+pkgdesc='Yet another Megadrive / Genesis / Sega CD / Mega CD / 32X / SMS emulator.'
+arch=(x86_64)
+url=http://notaz.gp2x.de
+license=(GPL2)
+depends=(alsa-lib hicolor-icon-theme libglvnd libpng sdl)
+makedepends=(gendesk glu freeglut ffmpeg libepoxy mesa openal txt2man zlib)
+source=("$pkgname"::git+https://github.com/irixxxx/"$pkgname".git
+        "$pkgname".patch)
+provides=("$pkgname")
+replaces=("$pkgname")
+sha256sums=('SKIP'
+            'b33b59f1574c7f216e47d517f2322fb80c8354cfb5d540ac7e4f2c594db65be2')
+
+pkgver() {
+  cd "$pkgname"
+  git describe --long --tags | sed 's/^v//;s/_/./;s/\([^-]*-g\)/r\1/;s/-/./g'
+}
+
+prepare() {
+  gendesk -f -n --name='Picodrive' --comment='A megadrive/genesis emulator' --custom='Keywords=game;console;' --exec="$pkgname" --icon="$pkgname" --terminal=false --categories='GNOME;GTK;Game' --startupnotify=false --pkgname="$pkgname"
+  git -C "$pkgname" submodule update --init --recursive
+  git -C "$pkgname" submodule update --checkout -f
+  patch -Np1 -i "$pkgname".patch
+  test -h "$pkgname/fmod" || ln -rsf fmod "$pkgname"/
+  test -f "$pkgname.svg" || inkscape "$pkgname"/platform/opendingux/data/megadrive.png --export-plain-svg --export-filename="$pkgname".svg
+  cd "$pkgname"
+  ./configure
+  make clean
+}
+
+build() {
+  cd "$pkgname"
+  make -j4
+}
+
+package() {
+  install -dm 755 "$pkgdir"/usr/{bin,share/{"$pkgname"/skin,applications,icons/hicolor/scalable/apps,man/man1}}
+  install -m 755 "$pkgname"/PicoDrive "$pkgdir"/usr/share/"$pkgname"/picodrive
+  install -m 644 picodrive.desktop "$pkgdir"/usr/share/applications/
+  install -m 644 "$pkgname"/platform/game_def.cfg "$pkgdir"/usr/share/"$pkgname"/
+  install -m 644 "$pkgname"/pico/carthw.cfg "$pkgdir"/usr/share/"$pkgname"/
+#  install -m 644 "$pkgname"/picodrive.1 "$pkgdir"/usr/share/man/man1/
+  install -m 644 "$pkgname"/platform/pandora/skin/* "$pkgdir"/usr/share/"$pkgname"/skin/
+  install -m 644 "$pkgname".svg "$pkgdir"/usr/share/icons/hicolor/scalable/apps/
+  ln -rsf "$pkgdir"/usr/share/"$pkgname/$pkgname" "$pkgdir"/usr/bin/
+}
diff a/picodrive/picodrive.patch b/picodrive/picodrive.patch
index e69de29..feb733a 100644
--- a/picodrive/picodrive.patch	1969-12-31 17:00:00.000000000 -0700
+++ b/picodrive/picodrive.patch	1969-12-31 17:00:00.000000000 -0700
@@ -0,0 +1,93 @@
+diff a/picodrive/Makefile b/picodrive/Makefile
+index 2903a68..bad1aa5 100644
+--- a/picodrive/Makefile	1969-12-31 17:00:00.000000000 -0700
++++ b/picodrive/Makefile	1969-12-31 17:00:00.000000000 -0700
+@@ -164,7 +164,8 @@ OBJS += platform/libpicofe/gl_platform.o
+ USE_FRONTEND = 1
+ endif
+ ifeq "$(PLATFORM)" "generic"
+-CFLAGS += -DSDL_OVERLAY_2X -DSDL_BUFFER_3X
++CFLAGS += -DHAVE_GLES
++LDFLAGS += -ldl -lpthread -lGL -lEGL
+ OBJS += platform/linux/emu.o platform/linux/blit.o # FIXME
+ ifeq "$(use_inputmap)" "1"
+ OBJS += platform/common/plat_sdl.o platform/opendingux/inputmap.o
+@@ -173,6 +174,7 @@ OBJS += platform/common/plat_sdl.o platform/common/inputmap_kbd.o
+ endif
+ OBJS += platform/libpicofe/plat_sdl.o platform/libpicofe/in_sdl.o
+ OBJS += platform/libpicofe/plat_dummy.o platform/libpicofe/linux/plat.o
++OBJS += platform/libpicofe/gl.o platform/libpicofe/gl_platform.o
+ USE_FRONTEND = 1
+ endif
+ ifeq "$(PLATFORM)" "pandora"
+diff a/picodrive/platform/libpicofe/gl.c b/picodrive/platform/libpicofe/gl.c
+--- a/picodrive/platform/libpicofe/gl.c	1969-12-31 17:00:00.000000000 -0700
++++ b/picodrive/platform/libpicofe/gl.c	1969-12-31 17:00:00.000000000 -0700
+@@ -2,7 +2,11 @@
+ #include <stdlib.h>
+ 
+ #include <EGL/egl.h>
+-#include <GLES/gl.h>
++#if defined(__arm__)
++  #include <GLES/gl.h>
++#else
++  #include <GL/gl.h>
++#endif
+ #include "gl_platform.h"
+ #include "gl.h"
+ 
+diff a/picodrive/platform/libpicofe/gl_platform.c b/picodrive/platform/libpicofe/gl_platform.c
+--- a/picodrive/platform/libpicofe/gl_platform.c	1969-12-31 17:00:00.000000000 -0700
++++ b/picodrive/platform/libpicofe/gl_platform.c	1969-12-31 17:00:00.000000000 -0700
+@@ -1,7 +1,11 @@
+ #include <stdio.h>
+ #include <stdlib.h>
+ #include <EGL/egl.h>
+-#include <GLES/gl.h>
++#if defined(__arm__)
++  #include <GLES/gl.h>
++#else
++  #include <GL/gl.h>
++#endif
+ 
+ #include "gl.h"
+ #include "gl_platform.h"
+
+diff a/picodrive/platform/libpicofe/in_sdl.c  b/picodrive/platform/libpicofe/in_sdl.c
+--- a/picodrive/platform/libpicofe/in_sdl.c	1969-12-31 17:00:00.000000000 -0700
++++ b/picodrive/platform/libpicofe/in_sdl.c	1969-12-31 17:00:00.000000000 -0700
+@@ -300,6 +300,34 @@
+ 		}
+ 		break;
+ 
++	case SDL_JOYHATMOTION:
++		if (event->jhat.which != state->joy_id)
++			return -2;
++		if (event->jhat.value == SDL_HAT_CENTERED) {
++			kc = state->axis_keydown[event->jhat.hat];
++			state->axis_keydown[event->jhat.hat] = 0;
++			ret = 1;
++		}
++		else if (event->jhat.value & SDL_HAT_UP || event->jhat.value & SDL_HAT_LEFT) {
++			kc = state->axis_keydown[event->jhat.hat];
++			if (kc)
++				update_keystate(state->keystate, kc, 0);
++			kc = (event->jhat.value & SDL_HAT_UP) ? SDLK_UP : SDLK_LEFT;
++			state->axis_keydown[event->jhat.hat] = kc;
++			down = 1;
++			ret = 1;
++		}
++		else if (event->jhat.value & SDL_HAT_DOWN || event->jhat.value & SDL_HAT_RIGHT) {
++			kc = state->axis_keydown[event->jhat.hat];
++			if (kc)
++				update_keystate(state->keystate, kc, 0);
++			kc = (event->jhat.value & SDL_HAT_DOWN) ? SDLK_DOWN : SDLK_RIGHT;
++			state->axis_keydown[event->jhat.hat] = kc;
++			down = 1;
++			ret = 1;
++		}
++		break;
++
+ 	case SDL_JOYBUTTONDOWN:
+ 	case SDL_JOYBUTTONUP:
+ 		if (event->jbutton.which != state->joy_id)
